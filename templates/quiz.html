<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz App</title>
  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

<div class="container py-5">
  <h1 class="mb-4 text-center">Quiz App</h1>

  <!-- Topic input -->
<div class="mb-3">
  <label for="topic" class="form-label fw-bold">Select Subject</label>
  <select id="topic" class="form-select">
    <option value="" selected disabled>-- Select a subject --</option>
    <option value="History">History</option>
    <option value="Geography">Geography</option>
    <option value="Polity">Polity</option>
    <option value="Economics">Economics</option>
    <option value="Science">Science</option>
    <option value="Current Affairs">Current Affairs</option>
  </select>
</div>

  <button class="btn btn-primary mb-4" onclick="getQuiz()">Start Quiz</button>

  <!-- Loading -->
  <div id="loading" class="alert alert-info" style="display:none;">
    Loading...
  </div>

  <!-- Quiz question & options -->
  <div id="questionArea" style="display:none;">
    <p id="questionText" class="fw-bold fs-5"></p>
    <div id="options" class="mb-3"></div>
    <button class="btn btn-success" onclick="submitAnswer()">Submit Answer</button>
  </div>

  <!-- Result -->
  <div id="result" class="mt-4 fs-5"></div>
</div>

<!-- Your JavaScript -->
<script>
let sessionId = null;
let selectedAnswer = null;

function getQuiz() {
  const topic = document.getElementById("topic").value.trim();
  if (!topic) {
    alert("Please enter a topic!");
    return;
  }

  document.getElementById("loading").style.display = "block";
  document.getElementById("questionArea").style.display = "none";
  document.getElementById("result").innerText = "";

  fetch("/quiz", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ topic })
  })
    .then(res => {
      if (!res.ok) throw new Error("Server error");
      return res.json();
    })
    .then(data => {
      sessionId = data.session_id;
      selectedAnswer = null;

      document.getElementById("questionText").innerText = data.question;

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      for (const [key, value] of Object.entries(data.options)) {
        const wrapper = document.createElement("div");
        wrapper.className = "form-check";

        const radio = document.createElement("input");
        radio.type = "radio";
        radio.className = "form-check-input";
        radio.name = "answer";
        radio.value = key;
        radio.id = `option_${key}`;
        radio.onclick = () => selectedAnswer = key;

        const label = document.createElement("label");
        label.className = "form-check-label";
        label.setAttribute("for", `option_${key}`);
        label.innerText = `${key}) ${value}`;

        wrapper.appendChild(radio);
        wrapper.appendChild(label);
        optionsDiv.appendChild(wrapper);
      }

      document.getElementById("questionArea").style.display = "block";
    })
    .catch(err => {
      console.error(err);
      alert("Could not load quiz question.");
    })
    .finally(() => {
      document.getElementById("loading").style.display = "none";
    });
}

function submitAnswer() {
  if (!selectedAnswer) {
    alert("Please select an answer!");
    return;
  }

  document.getElementById("loading").style.display = "block";
  document.getElementById("result").innerText = "";

  fetch("/answer", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      session_id: sessionId,
      answer: selectedAnswer
    })
  })
    .then(res => {
      if (!res.ok) throw new Error("Server error");
      return res.json();
    })
    .then(data => {
      if (data.result === "correct") {
        document.getElementById("result").innerHTML = `<span class="text-success">✅ Correct!</span> ${data.explanation}`;
      } else {
        document.getElementById("result").innerHTML =
          `<span class="text-danger">❌ Incorrect.</span> Correct Answer: <strong>${data.correct_answer}</strong>. ${data.explanation}`;
      }
      // Hide question area after answer is submitted
      document.getElementById("questionArea").style.display = "none";
    })
    .catch(err => {
      console.error(err);
      alert("Could not submit answer.");
    })
    .finally(() => {
      document.getElementById("loading").style.display = "none";
    });
}
</script>

<!-- Bootstrap JS Bundle (optional, for components) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
